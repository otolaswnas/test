(
  # 3 = brak danych (którykolwiek z krytycznych jobów nie odpowiada)
  3 * (
    (min by (openshiftcluster) (up{job=~"kube-apiserver|etcd", openshiftcluster=~"$openshiftcluster"}) == 0)
    or vector(0)
  )
)
+
(
  # 2 = krytyczny (etcd lub apiserver Available != 1)
  2 * (
    (min by (openshiftcluster) (cluster_operator_conditions{condition="Available",name=~"etcd|kube-apiserver",openshiftcluster=~"$openshiftcluster"}) == 0)
    or vector(0)
  )
)
+
(
  # 1 = anomalie (obaj Available=1, ale którykolwiek Degraded=1)
  (
    ((min by (openshiftcluster) (cluster_operator_conditions{condition="Available",name=~"etcd|kube-apiserver",openshiftcluster=~"$openshiftcluster"}) == 1) or vector(0))
    *
    clamp_max(
      (
        sum by (openshiftcluster) (cluster_operator_conditions{condition="Degraded",name=~"etcd|kube-apiserver",openshiftcluster=~"$openshiftcluster"} == 1)
        or vector(0)
      ),
      1
    )
  )
)
