# Sprawd≈∫ czy Prometheus ma dane z apiservera i etcd
(
  min(up{job=~"kube-apiserver|etcd"}) == 0
) * 3
+
(
  (min(up{job=~"kube-apiserver|etcd"}) == 1)
  *
  (
    # Krytyczny stan = 2
    ( (min(cluster_operator_conditions{condition="Available",name=~"etcd|kube-apiserver"}) == 0) * 2 )
    +
    # Anomalie = 1
    ( (min(cluster_operator_conditions{condition="Available",name=~"etcd|kube-apiserver"}) == 1)
      * clamp_max(sum(cluster_operator_conditions{condition="Degraded"} == 1), 1)
    )
  )
)
