import os
import json
from datetime import datetime

# Zakładamy, że obiekt 'es' jest już zainicjowany:
# es = Elasticsearch(...)

def backup_templates(es_client):
    # Generowanie nazwy katalogu: backup_ROK-MIESIAC-DZIEN_GODZINA-MINUTA
    folder_name = datetime.now().strftime("backup_%Y-%m-%d_%H-%M")
    
    if not os.path.exists(folder_name):
        os.makedirs(folder_name)

    try:
        # Pobranie wszystkich index templates
        response = es_client.indices.get_index_template()
        templates = response.get('index_templates', [])

        for item in templates:
            name = item['name']
            content = item['index_template']
            
            # Zapis każdego szablonu do osobnego pliku .json
            file_path = os.path.join(folder_name, f"{name}.json")
            with open(file_path, 'w', encoding='utf-8') as f:
                json.dump(content, f, indent=4, ensure_ascii=False)
            
            print(f"Zapisano szablon: {name}")
            
        print(f"\nGotowe. Szablony znajdziesz w folderze: {folder_name}")

    except Exception as e:
        print(f"Wystąpił błąd podczas pobierania szablonów: {e}")

# Wywołanie funkcji
backup_templates(es)
