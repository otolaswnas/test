if ! command -v getent && ! command -v host && ! command -v dig; then
  echo "Brak narzędzi do rozwiązywania nazw (getent, host, dig)!" >&2
  exit 1
fi

jq -r 'to_entries[] | select(.value.hosts) | .value.hosts | to_entries[] | .value["ansible-hostname"]' inventory.json | while read fqdn; do
  # Spróbuj getent, potem host, potem dig
  ip=$(getent hosts "$fqdn" 2>/dev/null | awk '{print $1}')
  if [ -z "$ip" ]; then
    ip=$(host "$fqdn" 2>/dev/null | awk '/has address/ {print $4; exit}')
  fi
  if [ -z "$ip" ]; then
    ip=$(dig +short "$fqdn" 2>/dev/null | head -n1)
  fi
  if [ -z "$ip" ]; then
    ip="brak_ip"
  fi
  echo "$fqdn $ip"
done
